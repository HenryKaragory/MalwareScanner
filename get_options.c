#include "include/malware_finder_options.h"

#include <string.h>
#include <stdlib.h>
#include <stdio.h>

PersistentOptions *get_persistent_options(){
	PersistentOptions *pers_options = malloc(sizeof(PersistentOptions));

	// Read in the persistent options from the .config file
	FILE *file = fopen("./config/malware_scanner.config", "r");
	if(file != NULL){
		char key_value_line[255];
		while(fgets(key_value_line, sizeof(key_value_line), file)){
			char *key = strtok(key_value_line, "=");
			char *char_value = strtok(NULL, "=");
			int value;

			if(strcmp(char_value, "YES\n") == 0){
				value = TRUE;
			}else{
				value = FALSE;
			}

			if(strcmp(key, "SEARCH_FILE_SYSTEM") == 0){
				pers_options->search_file_system = value;
			}else if(strcmp(key, "PRINT_MWARE_INFO") == 0){
				pers_options->print_mware_info = value;
			}
		}
	}

	return pers_options;
}

MalwareFinderOptions *get_mware_options_from_args(int argc, char *argv[]){
	return NULL;
}

MalwareFinderOptions *get_mware_options_from_prompt(){
	MalwareFinderOptions *mware_options;
	mware_options = malloc(sizeof(mware_options));

	printf("Enter the name of the malware you are scanning for: ");
	scanf("%s", mware_options->mware_name);

	printf("Would you like to search the list of running processes (yes/no): ");
	char char_search_running_processes[255];
	scanf("%s", char_search_running_processes);
	while(strcmp(char_search_running_processes, "yes") != 0 && strcmp(char_search_running_processes, "no") != 0) {
		printf("Bad input.\n");
		printf("Would you like to search the list of running processes (yes/no): ");
		scanf("%s", char_search_running_processes);
	}

	if(strcmp(char_search_running_processes, "yes\n") == 0){
		mware_options->search_running_processes = TRUE;
	}else{ 
		mware_options->search_running_processes = FALSE;
	}

	return mware_options;
}